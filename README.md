# VIXIndexCalculate

波动率指数（Volatility Index，VIX），又称恐慌指数，鉴于其有效反映美股市场恐慌和避险情绪而成为出色的市场情绪跟踪指标和风险对冲工具。早前和部分群友也有讨论过该指数，彼时临时找了芝加哥期权交易所（CBOE）公布的VIX指数的编制方案原版，仓促概览之后就指数编制的方法进行交流，但毕竟没实际计算过，对其中细节描述不甚理解，最后也未能形成较有建设性的交流结果。

这篇分享，是想对VIX指数的来龙去脉和iVIX的计算方法有一个较为通俗简明的介绍，当然更重要的是应用，情绪的高低直接影响策略的盈亏比和头寸的实际盈亏，这是作为交易员需要关注的最直接原因。

1 恐慌指数VIX

【VIX演进历史】

VIX是CBOE于1993年正式推出的指数，最早用于测度标普100指数平值期权所隐含的市场对未来30天波动的预期，指数点位越高代表投资者预期后市波动程度愈大，而这通常对应股市大跌恐慌的时候，因此该指数又称恐慌指数（fear index）。2003年CBOE联合高盛更新了VIX的算法，把标的指数改为标普500指数，同时把上述隐含波动率的计算范围从平值期权扩展为不同行权价位的Call和Put期权的加权。随后2004年3月推出了第一个VIX期货，2006年推出了第一个VIX期权，自此VIX相关期权和期货产品成为市场最受关注、交易活跃的品种之一，是投资和风险管理领域强大而灵活的金融工具。

事实上，时至今日，VIX家族逐渐扩大，CBOE先后又纳入短期波动率指数（VXSTSM，反映市场对标普500指数未来9天隐含波动的预期）、纳斯达克100波动率指数（VXNSM）, 道琼斯工业指数波动率指数（VXDSM）、罗素2000波动率指数（RVXSM）以及标普500指数的3个月和6个月波动率指数（VXVSM、VXMTSM）等。

2008年，CBOE率先将这套算法移植到商品和外汇上，由此创设出原油ETF 波动率指数（OVXSM）、黄金ETF波动率指数（GVZSM）以及欧元ETF波动率指数（EVZSM）等。

【VIX编制算法】

CBOE公布的VIX白皮书《The CBOE Volatility Index - VIX®》详细介绍了VIX具体编制方法，其核心计算公式如下：


其中，

σ1：近月波动率

NT：近月合约剩余到期时间（以分钟计）

T：NT/N365

R：无风险利率

S：认购期权价格与认沽期权价格相差最小的执行价

F：S+eRT×[认购期权价格(S)−认沽期权价格(S)]

K0：小于F且最接近于F的执行价

Ki：由小到大的所有执行价(i=1,2,3,….)

ΔKi：第i个执行价所对应的执行价间隔

P(Ki)：若Ki小于K0，为Ki对应的Put期权价格；若Ki大于K0，为Ki对应的Call期权价格；若Ki等于K0，为Ki对应的Call/Put期权价格

尽管白皮书在后面还有对每个变量的具体算法进行详细说明，但读起来仍旧十分晦涩。为此，下面会结合中国波指的实际计算案例来逐步说明，此处就先不赘述。

【VIX指数历史】

下图展示了VIX指数截至2019年10月18日的结果，可以明显看到“上无顶下有底”、“均值回归”等特点，群里各位大佬对该指数特征的分析和点评已经很多，此处不再赘述。


2 中国波指iVIX

【iVIX历史】

2015年2月19日，我国正式推出上证50ETF波动率指数，又称中国波指（iVIX），该指数由中证指数有限公司维护。但生不逢时，该指数刚诞生不久就遭遇较大的股市动荡，作为恐慌指数表现“过于耀眼”，2018年2月22日起，中证指数有限公司暂停发布中国波指(iVIX) 。据了解，部分做量化策略（特别是期权策略）的私募机构、卖方机构（含数据公司）均有基于美国VIX指数编制方法重新复现iVIX指数，卖方机构会将该指数更新作为付费或潜在客户的投研服务，但未公开相关代码，仅有部分卖方研报有提到一些算法细节。目前所了解的免费行情更新来源主要是期权论坛中的QVIX指数，该指数脚注有注明“历史回测显示，上交所iVix和期权论坛qVix误差小于0.5%，但不代表未来及极端情况”。

【iVIX复现】

根据《上证50ETF波动率指数编制方案》介绍，iVIX是基于方差互换原理，根据上交所挂牌的50ETF期权合约编制而成，反映投资者对未来30天50ETF波动率的预期。尽管上交所未公开iVIX指数的编制方式，但经数据验证发现，iVIX指数编制方式与芝加哥期权交易所（CBOE）推出的CBOE Volatility Index® (VIX®Index)非常相似。本文基于2019年10月18日收盘时各档执行价的期权收盘价格计算当天的隐含波动率，基于数据可获得性原因，在部分处理细节上进行了一定简化，但核心算法仍与CBOE保持一致：

第一步，计算期权剩余时间。由于50ETF的iVIX指数是通过计算近月及次近月合约的加权波动率来复合出未来30天的波动率（预期），为确定各自的权重，需计算当前时刻到近月期权到期时刻的剩余时间T1和当前时刻到次近月期权到期时刻的剩余时间T2，理论上需要精确到分钟，我们这里只精确到天。同时，如果当前时刻距离当月合约到期日不超过7天，则计算的当月合约应变成次月合约和距离次月合约最近的下一个合约。算好之后先放一下，后面会结合第九步计算出来的方差用来直接计算最终的VIX指数结果：


其中，N30是一个月的天数（此处取30天），而N365是一年的天数（此处取365天）。经过第一步，上述公式中除了σ1和σ2，其他都已经可知。

2019年10月18日对应本月合约的到期日是2019年10月23日，差距只有5天，因此此处选择11月和12月的合约作为今日VIX指数的标的月份，对应的合约到期日分别为2019年11月27日和2019年12月25日，因此对应NT1和NT2分别为40和68天，T1和T2分别为40/365=0.1096和68/365=0.1863。

第二步，获得无风险利率水平。本文取无风险利率为固定的3%，有研究报告指出，无风险利率在这个数值周边几个百分点的之内的变动对结果影响不大，精细化的算法可根据国债利率期限结构通过插值法取得T2和T1对应的无风险利率。

第三步，确定标的远期价格水平Fi。比较同一月份期权认购期权与认沽期权的价格的差值，差值的绝对值最小的期权组合确认为平值期权，该平值价格(KATM)对应为远期价格水平的计算锚，远期价格水平的计算公式为：


2019年10月18日，2019年11月和12月的合约对应期权收盘价，Call和Put价差（C_P）及价差绝对值（Gap）分别列示和计算如下：


(2019年11月合约)


(2019年12月合约)

对于11月合约：根据Gap最小原则，平值期权对应执行价确认为3，对应远期价格水平计算如下：

F1=3 +e^(3%*0.1096)*0.0101=3.0101

对于12月合约：根据Gap最小原则，平值期权对应执行价同样为3，对应远期价格水平计算如下：

F2=3 +e^(3%*0.1863)*0.0106=3.0107

第四步，确定间隔执行价K0，用以确认参与计算的期权。K0为稍小于F并离F最近的可用执行价，近月的K0记为K0,1，次近月的K0记为K0,2。根据2019年10月18日的F1和F2，可知K0,1= K0,2=3。该参数的作用是在第五步用以筛选纳入VIX计算的虚值期权。

第五步，挑选参与VIX计算的平值和虚值期权。将期权列表按执行价升序排列，其中平值即执行价为K0的期权，从K0向上开始依次选取小于K0的虚值Put期权，从K0向下开始依次选取大于K0的虚值Call期权。根据2019年10月18日的数据，所有参与计算VIX的期权组合如下所示：


(2019年11月合约)


(2019年12月合约)

第六步，填充参与VIX计算的平值和虚值期权的价格。平值期权的价格为执行价为K0的Call与Put期权价格的平均数，Call期权的价格即为对应Call期权的收盘价格，Put期权的价格即为对应Put期权的收盘价格，根据2019年10月18日的数据，所有参与计算VIX的期权的价格为：


(2019年11月合约)


(2019年12月合约)

第七步，计算执行价价差△K。将期权合约按照行权价从小到大排序，相邻合约行权价的差值即为△K，执行价价差均为正数，根据2019年10月18日的数据，所有参与计算VIX的期权的△K为：


(2019年11月合约)


(2019年12月合约)

第八步，根据公式(△Ki/Ki^2)*e^RT*P(Ki)计算各个期权的方差贡献，其中T、R、Ki、P(Ki)以及△Ki分别对应第一步、第二步、第五步、第六步以及第七步的结果。根据2019年10月18日的数据，各个期权的方差贡献为：


(2019年11月合约)


(2019年12月合约)

上述蓝色框内部求和后分别为0.0011和0.0023。



第九步，根据以下公式计算近月和次近月合约的方差：


根据2019年10月18日的数据，近月及次近月合约方差为：

σ1=(2/0.1096)*0.0011-[3.0101/3-1]^2/0.1096=0.0202

σ2=(2/0.1863)*0.0023-[3.0107/3-1]^2/0.1863=0.0243

最后根据公式：


代入计算可得，VIX=13.0185。注意，上述各个步骤计算过程中，原始计算保留了10余位小数，本文为节省空间仅保留四位。

根据以上算法复原了iVIX上市以来的数据，为了检验复现效果，本文截取了官方停止更新之前的iVIX指数和iVIX复原指数进行对比，结果显示，在2015年2月19日至2018年2月14日区间内，二者的相关系数为99.25%，基本达到可用级别。


下面展示了iVIX指数成立以来截至最新的数据结果以及历史标准差分位。可以看到，不同于美国恐慌指数在股市暴跌时大涨，我国iVIX指数在股市快速上涨时也会上拉（比如2019年2-3月），再次印证管大讲过的，Skew曲线所显示的A股投资者“踏空之痛甚于套牢之苦”的情绪特征。


上述分享的意义不在于用多么复杂的方式还原出了一个指数，而是通过这个还原出来的指数跟踪50ETF期权的隐含波动率水平，隐含波动率的升高是有利于期权多头仓位，而近期的iVIX快速消退，跌破一个标准差偏离，有卖权仓位的需要注意风险。对于非期权交易者，也可以通过观察iVIX指数辅助判断出入场，若在指数高位时入场，保守型投资者应格外谨慎市场的波动。
